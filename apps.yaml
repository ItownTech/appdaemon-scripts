#################################################################
## Global
#################################################################
global_modules:
  - secrets
  - messages

#################################################################
## Security
#################################################################
detectWrongStateWhenLeaving:
  module: detectWrongStateWhenLeaving
  class: DetectWrongStateWhenLeaving
  sensor: binary_sensor.motion_sensor_158d00012aab97,media_player.denon_avrx1300w,switch.livingroom_large_lamp,switch.studyroom_lamp,switch.livingroom_small_lamp,switch.studyroom_ceiling_lamp,switch.storageroom_ceiling_lamp,switch.kitchen_ceiling_lamp,switch.livingroom_ceiling,switch.lobby_ceiling,switch.snowboard,light.bedroom_yeelight,light.bar_table
  isHome: input_boolean.is_home

notfiyOfActionWhenAway:
  module: notfiyOfActionWhenAway
  class: NotfiyOfActionWhenAway
  sensor: binary_sensor.door_window_sensor_158d000126a57b,binary_sensor.motion_sensor_158d00012aab97,media_player.denon_avrx1300w,switch.livingroom_large_lamp,switch.studyroom_lamp,switch.livingroom_small_lamp,switch.studyroom_ceiling_lamp,switch.storageroom_ceiling_lamp,switch.kitchen_ceiling_lamp,switch.livingroom_ceiling,switch.lobby_ceiling,switch.snowboard,light.bedroom_yeelight,light.bar_table
  isHome: input_boolean.is_home
  user_name: group_notifications
  global_dependencies:
    - messages
    - secrets
  
#################################################################
## eventMonitor
#################################################################
#eventMonitor:
#  module: eventMonitor
#  class: Monitor
#  events: click,motion_action

#################################################################
## ButtonClicked
#################################################################
#Toggle Studyroom lamp when Xiaomi Button is clicked once
xiaomiroundButtonClicked:
  module: buttonClicked
  class: ButtonClicked
  sensor: binary_sensor.switch_158d00012db9e5
  actor_single: switch.studyroom_lamp
  actor_double: switch.studyroom_ceiling_lamp
#################################################################
## MotionTrigger
#################################################################
obenTreppeMotionTrigger:
  module: motionTrigger
  class: MotionTrigger
  sensor: binary_sensor.motion_sensor_158d00012aab97
  entity_on: light.treppe_oben
  entity_off: light.treppe_oben
  after_sundown: True
#################################################################
## ComingHome
#################################################################
#Switch on Lobby lamp when the first person is coming home and the sun is down
comingHome:
  module: comingHome
  class: ComingHome
  sensor: binary_sensor.door_window_sensor_158d000126a57b
  isHome: input_boolean.is_home
  actor: switch.livingroom_large_lamp

#Notification if user one arrives at home
homeArrivalNotifierUserOne:
  module: homeArrivalNotifier
  class: HomeArrivalNotifier
  input_boolean: input_boolean.user_one_home
  notify_name: secret_name_user_one
  zone_name: Home
  global_dependencies:
    - secrets
    - messages

#Notification if user two arrives at home
homeArrivalNotifierUserTwo:
  module: homeArrivalNotifier
  class: HomeArrivalNotifier
  input_boolean: input_boolean.user_two_home
  notify_name: secret_name_user_two
  zone_name: Home
  global_dependencies:
    - secrets
    - messages 
#################################################################
## Presence
#################################################################
#Control the isHome state. Determines if someone is home or all persons are away
isHomeDeterminer:
  module: isHomeDeterminer
  class: IsHomeDeterminer
  ishome: input_boolean.is_home
  input_booleans: input_boolean.user_one_home,input_boolean.user_two_home
  global_dependencies:
    - messages
    - secrets

#Determine if user one gets/leaves home
isUserHomeDeterminerUserOne:
  module: isUserHomeDeterminer
  class: IsUserHomeDeterminer
  input_boolean: input_boolean.user_one_home
  device_tracker: secret_device_user_one
  door_sensor: binary_sensor.door_window_sensor_158d000126a57b
  global_dependencies:
    - secrets
    - messages

#Determine if user two gets/leaves home
isUserHomeDeterminerUserTwo:
  module: isUserHomeDeterminer
  class: IsUserHomeDeterminer
  input_boolean: input_boolean.user_two_home
  device_tracker: secret_device_user_two
  door_sensor: binary_sensor.door_window_sensor_158d000126a57b
  global_dependencies:
    - secrets
    - messages   
#################################################################
## DeviceNotify
#################################################################
newWifiDeviceNotify:
  module: newWifiDeviceNotify
  class: DeviceNotify
  global_dependencies:
    - messages
#################################################################
## NotifyFailedLogin
#################################################################
notifyFailedLogin:
  module: notifyFailedLogin
  class: NotifyFailedLogin
  user_name: secret_name_user_one
  global_dependencies:
    - messages
    - secrets
#################################################################
## GoogleTravelTime
#################################################################
googleTravelTime_home_from_work:
  module: google_travel_time
  class: GoogleTravelTime
  sensor: sensor.travel_time_home_from_work
  notify_input_boolean: input_boolean.travel_time_home_from_work
  notify_name: group_notifications
  global_dependencies:
    - secrets
    - messages

googleTravelTime_work_from_home:
  module: google_travel_time
  class: GoogleTravelTime
  sensor: sensor.travel_time_work_from_home
  notify_input_boolean: input_boolean.travel_time_work_from_home
  notify_name: group_notifications
  global_dependencies:
    - secrets
    - messages

googleTravelTime_elmo_from_home:
  module: google_travel_time
  class: GoogleTravelTime
  sensor: sensor.travel_time_elmo_from_home
  notify_input_boolean: input_boolean.travel_time_elmo_from_home
  notify_name: group_notifications
  global_dependencies:
    - secrets
    - messages

nextApppointmentLeaveNotifier:
  module: nextApppointmentLeaveNotifier
  class: NextApppointmentLeaveNotifier
  sensor: sensor.calc_leave_time
  notify_input_boolean: input_boolean.announce_time_to_leave
  notify_name: group_notifications
  input_number: input_number.leave_time_offset
  destination_name_sensor: sensor.cal_next_appointment_location
  travel_time_sensor: sensor.travel_time_next_appointment_location
  global_dependencies:
    - secrets
    - messages
#################################################################
## ZoneNotifiers
#################################################################
leavingWorkNotifierUserOne:
  module: leavingZoneNotifier
  class: LeavingZoneNotifier
  proximity: proximity.work
  device: secret_name_user_one
  user_name: secret_name_user_one
  zone: Work
  zone_tracker_delay: 180
  global_dependencies:
    - secrets
    - messages

headingHomeNotifierUserOne:
  module: headingToZoneNotifier
  class: HeadingToZoneNotifier
  proximity: proximity.home_user_one
  device: secret_name_user_one
  user_name: secret_name_user_one
  notify_name: secret_name_user_two
  notify_input_boolean: input_boolean.heading_home_notifier_user_one
  global_dependencies:
    - secrets
    - messages

zoneArrivalNotifier:
  module: zoneArrivalNotifier
  class: ZoneArrivalNotifier
  global_dependencies:
    - secrets
    - messages
#################################################################
## RoomBasedLightControl
#################################################################
roomBasedLightControl:
  module: roomBasedLightControl
  class: RoomBasedLightControl
  room_sensor: sensor.mqtt_room_user_one
  entity: input_boolean.room_based_light
  mappings:
    livingroom:
      room: livingroom
      entity: switch.large_lamp
    bedroom:
      room: bedroom
      entity: light.bedroom_yeelight
  global_dependencies:
    - secrets
    - messages

